<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>1. Species data</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">SDM Course</a>
</li>
<li>
  <a href="syllabus.html">Course schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    R exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Exercise1.html">1. Species data</a>
    </li>
    <li>
      <a href="Exercise2.html">2. Environment data</a>
    </li>
    <li>
      <a href="Exercise3.html">3. SDMs: algorithms</a>
    </li>
    <li>
      <a href="Exercise4.html">4. SDMs: evaluation</a>
    </li>
  </ul>
</li>
<li>
  <a href="Resources.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">1. Species data</h1>

</div>


<p><span class="math inline">\(~\)</span></p>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>In this exercise, you will:</p>
<ul>
<li>Download species occurrence data from GBIF using <a
href="https://docs.ropensci.org/rgbif/index.html"><code>rgbif</code></a></li>
<li>Clean species occurrence data using <a
href="https://ropensci.github.io/CoordinateCleaner/"><code>CoordinateCleaner</code></a></li>
<li>Generate data for a <em>virtual</em> species using <a
href="http://borisleroy.com/virtualspecies_tutorial/"><code>virtualspecies</code></a></li>
</ul>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="obtaining-data" class="section level3">
<h3>Obtaining data</h3>
<p>There is a large and growing number of databases that contain species
occurrence records (e.g., GBIF, eBird, iNaturalist, BIEN, etc.). These
databases are sometimes based on certain taxa or geographic regions so
it is important to find a source that best meets the needs of your
project. While we won’t focus on it in this exercise, note that the <a
href="https://docs.ropensci.org/spocc/"><code>spocc</code></a> package
can be used to query and collect species occurrence data from many
sources.</p>
<p>We will focus on obtaining data from GBIF using the
<code>rgbif</code> package, which has its own <a
href="https://docs.ropensci.org/rgbif/articles/rgbif.html">detailed
vignette</a> as well as a helpful <a
href="https://vimeo.com/127119010">screencast</a>.</p>
<p>In this short exercise, we will download data for a focal species.
You will also download data from GBIF in the following section on
cleaning occurrence data.</p>
<pre class="r"><code>library(rgbif)

# You can query GBIF using a species name or a taxonomic key
# One way to find the key for your study species is:
key &lt;- name_suggest(q=&quot;Canis lupus&quot;, rank=&quot;species&quot;)$data$key[1]

# Now download occurrence data for your species
# Note: by default, this function will only be limited to 500 observations
# Note: this can takes some time if there are many observations
gbif_data &lt;- occ_search(taxonKey=key, # query by taxonomic key
                        limit=10000, # increase the number of records downloaded
                        hasCoordinate=TRUE) # only get records with geographic coordinates</code></pre>
<p>You can also search directly by species name and filter the results
in various ways. For example:</p>
<pre class="r"><code>occ_search(scientificName=&quot;Canis lupus&quot;)

# There are many options to filter the records returned, e.g.,
gbif_data &lt;- occ_search(scientificName=&quot;Canis lupus&quot;,
                        continent=&quot;europe&quot;,  # only get records from Europe
                        limit=10000,
                        hasCoordinate=TRUE,
                        hasGeospatialIssue=FALSE)</code></pre>
<p>We have downloaded data but what do we actually have?</p>
<p>The <code>occ_search</code> function returns an object of class
<code>gbif</code>. This is essentially a list with slots for metadata
(meta), the occurrence data itself (data), the taxonomic hierarchy data
(hier), and media metadata (media). For more details, see
<code>?occ_search</code>. Generally, we are most interested in the
actual occurrence data, which is available in the (data) slot.</p>
<pre class="r"><code>gbif_data$data</code></pre>
<p>As you will see, there is a lot of information held here but, for
now, we focus only on the geographic locations of records. Let’s plot
the records we downloaded on a map (with help from the <code>maps</code>
package).</p>
<pre class="r"><code>library(maps)
map(fill=TRUE, col=&#39;grey&#39;)
points(gbif_data$data$decimalLongitude, 
       gbif_data$data$decimalLatitude, 
       bg=rgb(1,0,0,0.5), pch=21, lwd=0.5)</code></pre>
<p><img src="Exercise1_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>There are a lot of points scattered around Europe but also some
seemingly strange points. Wolves in Greenland? Wolves in the Canary
Islands? Hmmm… Let’s zoom in on Europe.</p>
<pre class="r"><code>map(xlim = c(-20, 59),
    ylim = c(35, 71), fill=T, col=&#39;grey&#39;)
points(gbif_data$data$decimalLongitude, 
       gbif_data$data$decimalLatitude, 
       bg=rgb(1,0,0,0.5), pch=21, lwd=0.5)</code></pre>
<p><img src="Exercise1_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>This looks nice… But are there wolves in the North sea? Why so many
observations in Spain / Belgium and yet so few in France? It seems that
we need to think more about these observations in terms of potential
errors as well as biases.</p>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="cleaning-coordinates" class="section level3">
<h3>Cleaning coordinates</h3>
<p>The fact that we have species occurrence data at our fingertips has
largely driven the increased use of SDMs/ENMs. Unfortunately, these data
sometimes contain errors of various types and it is important to
<em>clean</em> the data prior to use in order to avoid problems and
erroneous conclusions.</p>
<p>For this exercise, we will work through the tutorial from the <a
href="https://ropensci.github.io/CoordinateCleaner/articles/Cleaning_GBIF_data_with_CoordinateCleaner.html"><code>CoordinateCleaner</code></a>
package to acquire and clean data from GBIF. Make sure you install and
load the package before beginning.</p>
<pre class="r"><code>install.packages(&quot;CoordinateCleaner&quot;)
library(&quot;CoordinateCleaner&quot;)</code></pre>
<p>Then proceed to work through this vignette: <a
href="https://ropensci.github.io/CoordinateCleaner/articles/Cleaning_GBIF_data_with_CoordinateCleaner.html">https://ropensci.github.io/CoordinateCleaner/articles/Cleaning_GBIF_data_with_CoordinateCleaner.html</a></p>
<p>Note that there are other packages to clean occurrence data (e.g., <a
href="https://github.com/ropensci/scrubr"><code>scrubr</code></a>). The
<code>CoordinateCleaner</code> vignette includes a nice comparison of
different packages (<a
href="https://ropensci.github.io/CoordinateCleaner/articles/Comparison_other_software.html">see
here</a>).</p>
<p><strong><em>If you have time: Use <code>CoordinateCleaner</code> with
the data we downloaded for Canis lupus. What records are
flagged?</em></strong></p>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="virtual-species" class="section level3">
<h3>Virtual species</h3>
<p>It can be useful to generate a <em>virtual</em> species, with known
properties (spatial distribution, relationship with environmental
variables, abundance) for various reasons. For example, to test
methodological choices when building species distribution models. It is
possible to simulate the distribution of a virtual species in many
different ways but here we will use the <code>virtualspecies</code>
package (you can read the paper associated with the package <a
href="https://onlinelibrary.wiley.com/doi/full/10.1111/ecog.01388">here</a>).
Of course, you need to first install and load the package:</p>
<pre class="r"><code>install.packages(&quot;virtualspecies&quot;)
library(&quot;virtualspecies&quot;)</code></pre>
<p>Then work through the <code>virtualspecies</code> tutorial here: <a
href="http://borisleroy.com/virtualspecies_tutorial/">http://borisleroy.com/virtualspecies_tutorial/</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
